title: 谈谈MySQL的索引
date: 2019-07-13
tags: ['MySQL', '数据结构']
----

# 学会用索引

通常大家会根据常用的where字段来创建适合的索引

## B-Tree
最常用的索引时B-Tree，实际实现时是用B+Tree

索引的有点：
1 大大减少服务器需要扫描的数据量
2 可以帮助避免排序和临时表
3. 可以将随机IO变成顺序IO
4. 可以让查询锁定更少的行

## 哪些地方需要索引

* 经常需要排序的字段
* 经常需要查询的字段


## 聚簇索引

并不是单独的一种索引，而是一种数据存储方式。具体细节依赖于某种实现方式，但InnoDB的聚蔟是在同一个结构中保存了B-Tree索引和数据行。

聚蔟表示数据行和相邻的键值紧凑地存储在一起。因为无法把数据放在两个地方，所以一个表只能有一个聚蔟索引。 

优点：
1. 可以把相关的关系数据存在一起。例如实现电子邮箱，可以根据用户ID聚集数据，只需要从磁盘读取少量的数据页就可以读取用户的全部邮件。如果没有使用聚蔟，则每封邮件都要一次磁盘IO。
2. 数据访问更快。聚蔟索引把索引和数据放在同一个B-Tree中，因此通常更快。
3. 使用覆盖索引扫描可以直接使用页节点的主键值。

缺点：
1 插入速度依赖插入顺序
2 插入或者更新数据，可能有 “页分裂”问题。
3 聚蔟索引可能导致全表扫描变慢。

## 复合索引
索引可以包含一个、两个或更多个列。两个或更多个列上的索引被称作复合索引。

利用索引中的附加列，您可以缩小搜索的范围，但使用一个具有两列的索引不同于使用两个单独的索引。复合索引的结构与电话簿类似，人名由姓和名构成，电话簿首先按姓氏对进行排序，然后按名字对有相同姓氏的人进行排序。如果您知道姓，电话簿将非常有用；如果您知道姓和名，电话簿则更为有用，但如果您只知道名不姓，电话簿将没有用处。

所以说创建复合索引时，应该仔细考虑列的顺序。对索引中的所有列执行搜索或仅对前几列执行搜索时，复合索引非常有用；仅对后面的任意列执行搜索时，复合索引则没有用处。

![](https://images.cnblogs.com/cnblogs_com/ashou706/55.png)


